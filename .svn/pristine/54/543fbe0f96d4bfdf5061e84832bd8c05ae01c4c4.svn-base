<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ page import="trip.util.*" %>
<%@ include file="../include/head.jsp" %>
<%
request.setCharacterEncoding("UTF-8");
String pageno  = request.getParameter("page");
String type  = request.getParameter("type");
String[] season   = request.getParameterValues("season"  );
String[] local    = request.getParameterValues("local"   );
String[] human    = request.getParameterValues("human"   );
String[] move     = request.getParameterValues("move"    );
String[] schedule = request.getParameterValues("schedule");
String[] uinout   = request.getParameterValues("uinout"  );
String[] keyword   = request.getParameterValues("keyword"  );
if(pageno  == null) pageno  = "1";
if(type    == null) type    = "T";
if(keyword == null) keyword = new String[] {""};

int curpage = 1;
try
{
	curpage = Integer.parseInt(pageno);
}catch(Exception e){}


boardDTO bdto = new boardDTO();
ArrayList<boardVO> list = bdto.GetList(curpage, type, keyword);

//전체 게시물 갯수를 조회한다.
int total = bdto.GetTotal(type, keyword);
System.out.println("type : "+ type);
System.out.println("keyword : "+ keyword);
System.out.println("total : "+ total);

//최대 페이지 번호를 계산한다.
int perPage = 30;
int maxpage = total / perPage;	
if( total % perPage != 0) maxpage++;

//파라메터를 생성한다.
String search_param = "";
search_param += Param.getParam(season,"season");
search_param += "&";
search_param += Param.getParam(local,"local");
search_param += "&";
search_param += Param.getParam(human,"human");
search_param += "&";
search_param += Param.getParam(move,"move");
search_param += "&";
search_param += Param.getParam(schedule,"schedule");
search_param += "&";
search_param += Param.getParam(uinout,"uinout");

String param = "";
param += "type=" + type;
param += "&";
param += Param.getParam(keyword,"keyword");
param += "&";
param += search_param;
%>  
<link rel="stylesheet" type="text/css" href="../css/index.css">

<script>
	$(document).ready(function()
	{
		$(".write_button").click(function(){
			if(confirm("글쓰기 페이지로 이동하시겠습니까?") == true)
			{
				document.location = "../board/write.jsp";
			}
		});
		
		$(".keyword_button").click(function(){
			if(confirm("키워드선택 페이지로 이동하시겠습니까?") == true)
			{
				document.location = "../firstmain/main.jsp";
			}
		});
		
		/* $(".view")
		.click(function(){
				document.location = "../board/view.jsp";
		})
		.mouseover(function(){
			$(this).css("background-color", "#F0F1EC");
		})
		.mouseout(function()
		{
			$(this).css("background-color", "");
		}); */
		
	});
		
	$(function()
	{
		var firstSlide = 
		$('.slider').find('li').first()			// 첫번째 슬라이드		
		.stop(true).animate({'opacity':1},200);	// 첫번째 슬라이드만 보이게 하기
	      
		// 이전버튼 함수
		function PrevSlide()
		{ 
		    stopSlide(); startSlide();		//타이머 초기화
		    
		    var lastSlide = $('.slider').find('li').last()	//마지막 슬라이드
		    .prependTo( $('.slider'));						//마지막 슬라이드를 맨 앞으로 보내기	
		     						  
		    secondSlide =  $('.slider').find('li').eq(1)	//두 번째 슬라이드 구하기
		    .stop(true).animate({'opacity':0},400); 		//밀려난 두 번째 슬라이드는 fadeOut 시키고
		    
		    firstSlide =  $('.slider').find('li').first() 	//맨 처음 슬라이드 다시 구하기
		    .stop(true).animate({'opacity':1},400);			//새로 들어온 첫 번째 슬라이드는 fadeIn 시키기
		 }
		 
		// 다음 버튼 함수	  
	  	function NextSlide()
	  	{ 
	   	 	stopSlide();startSlide();		//타이머 초기화
	   	 	
	    	firstSlide = $('.slider').find('li').first() 	// 첫 번째 슬라이드
		    .appendTo($('.slider')); 					 	// 맨 마지막으로 보내기
		    
		    var lastSlide = $('.slider').find('li').last() 	// 맨 마지막으로 보낸 슬라이드
		    .stop(true).animate({'opacity':0},400); 		// fadeOut시키기
		    
		    firstSlide = $('.slider').find('li').first()	// 맨 처음 슬라이드
		    .stop(true).animate({'opacity':1},400);			// fadeIn 시키기
	 	 }
	  
	    $('#next').on('click', function()
		{ 
			// 다음버튼 클릭
	    	NextSlide();
	    });
	  
		 $('#prev').on('click', function()
		 { 
			// 이전 버튼 클릭 
		 	PrevSlide();
		 });
	  
		// 자동 슬라이드 시작
		startSlide();
		var theInterval;
		
		//자동 슬라이드 설정
		function startSlide()
		{
			theInterval = setInterval(NextSlide, 5000); 
		}
		
		//자동 멈추기
		function stopSlide() 
		{ 
			clearInterval(theInterval);
		}
		  
		//마우스 오버시 슬라이드 멈춤
		$('.slider').hover(function()
		{ 
			stopSlide();
		}, 
		function()
		{
			startSlide();
		});
	});	
	
function DoSearch()
{
	document.location = "index.jsp?<%= search_param %>&type=" + $("#type").val() + "&keyword=" + $("#keyword").val();
}	
	
</script>
		
<table border="0" style="width: 90%;" align="center">
	<tr align="center">
		<td>
			<section style="height: 450px;">
			  <ul class="slider">
			    <li>
			      <div style="background-image:url('https://cdn.pixabay.com/photo/2019/07/24/10/22/rose-4359808_960_720.jpg')">
			        <dl class="right">
			          <dt>만천하에 피어나는</dt>
			          <dd>따뜻한 예수는 하는 모래뿐일 찬미를 군영과 주는 무엇을 만천하의 칼이다.</dd>
			        </dl>
			      </div>
			    </li>
			    <li>
			      <div style="background-image:url('https://cdn.pixabay.com/photo/2019/07/29/09/16/landscape-4370250_960_720.jpg');">
			        <dl>
			          <dt>생명을 그러므로</dt>
			          <dd>만천하의 피어나는 있는 같이, 못할 되려니와, 커다란 쓸쓸하랴?</dd>
			        </dl>
			      </div>
			    </li>
			    <li>
			      <div style="background-image:url('https://cdn.pixabay.com/photo/2019/07/27/11/25/drinking-glasses-4366559_960_720.jpg');">
			        <dl class="right">
			          <dt>인생을 반짝이는</dt>
			          <dd>생명을 그러므로 있을 철환하였는가? 천자만홍이 없으면, 것이다.</dd>
			        </dl>
			      </div>
			    </li>
			    <li>
			      <div style="background-image:url('https://cdn.pixabay.com/photo/2019/06/17/15/41/landscape-4280257_960_720.jpg');">
			        <dl>
			          <dt>산야에 가진 불러보라</dt>
			          <dd>인생을 반짝이는 청춘이 힘차게 하였으며, 보이는 이것이야말로 있는가?</dd>
			        </dl>
			      </div>
			    </li>
			    <li>
			      <div style="background-image:url('https://cdn.pixabay.com/photo/2019/07/10/22/41/zinnowitz-4329714_960_720.jpg');">
			        <dl class="right">
			          <dt>풀이 얼음이 무엇을</dt>
			          <dd>피고, 산야에 가진 불러 보라. 노년에게서 때에, 인생에 인간에 트고, 듣는다.</dd>
			        </dl>
			      </div>
			    </li>
			    <li>
			      <div style="background-image:url('https://cdn.pixabay.com/photo/2019/06/24/15/31/forest-4296305_960_720.jpg');">
			        <dl>
			          <dt>끓이는 것이다</dt>
			          <dd>풀이 얼음이 무엇을 청춘의 우리의 만물은 그리하였는가?</dd>
			        </dl>
			      </div>
			    </li>
			  </ul>
			  <div class="btn" style="padding-top:135px; padding-right: 100px;">
			    <button type="button" id="prev" style="width: 35px;"><</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			    <button type="button" id="next" style="width: 35px;">></button>
			  </div>
			</section>
		</td>					
	</tr>
</table>
<table border="0" style="width: 90%; margin-top: -100px;" align="center">
	<tr>
		<td style="text-align: right; width: 650px;">
			<select id="type" name="type" style="width: 100px; height: 35px; font-size: 20px; margin-right : 20px;">
				<option value="T" <%= type.equals("T") ? "selected" : "" %>>제목</option>
					<option value="N" <%= type.equals("N") ? "selected" : "" %>>내용</option>
					<option value=""  <%= type.equals("")  ? "selected" : "" %>>제목+내용</option>
					<option value="U" <%= type.equals("U") ? "selected" : "" %>>닉네임</option>
					<option value="U" <%= type.equals("S") ? "selected" : "" %>>계절</option>
			</select>
			<%  // 검색된 
				String searchKeys = "";
				for(String key : keyword)
				{
					searchKeys += (key + " ");
				}
				%>
		</td>
		<td style="text-align: left;">
			<input type="text" id = "keyword" style="font-size: 20px; height: 33px;" placeholder="검색어를 입력해주세요.">
			<input type="button" onclick="DoSearch();" id = "DoSearch"  value="검색하기" class="search_button">검색하기&nbsp;&nbsp;&nbsp;&nbsp;
		</td>
		<td style="text-align: right;">
			<button type="button" class="keyword_button">키워드 선택</button>
		</td>
		<td style="text-align: right;">
			<button type="button" class="write_button">글쓰기</button>
		</td>
	</tr>
	<tr>
		<td><br></td>
	</tr>
</table>
<hr style="margin-bottom : 40px; margin-top : 0px;">
<table border="1" style="width: 90%; font-size: 18px;" align="center">
	<tr style="background-color: lightgray;">
		<td style="width: 50px;">번호</td>
		<td style="width: 150px;">키워드</td>
		<td style="width: 300px;">제목</td>
		<td style="width: 80px;">작성자</td>
		<td style="width: 80px;">작성일</td>
		<td style="width: 50px;">조회수</td>
		<td style="width: 50px;">추천수</td>
	</tr>
		
	<% 
	int seqNo = total -((curpage-1)*30);
	for(boardVO vo : list)
	{
		String link_str = "";
		link_str = "type="+ type;
		for(String item: keyword)
		{
			link_str += "&keyword="+ item;
		}
		link_str += "&page=" + curpage + "&no=" + vo.getBno();
		%>
		<tr onclick="view('<%= link_str %>');" style="cursor: pointer;">
			<td><%= seqNo-- %></td>
			<td>
				<span style="width: 130px;">
					<span style="color: hotpink; font-size: 13px; width: 20px;">
						<%=(!vo.getSeason().equals("null"))?vo.getSeason():"" %>
					</span>&nbsp;
					<span style="color: saddlebrown; font-size: 13px; width: 30px;">
						<%=(!vo.getLocal().equals("null"))?vo.getLocal():"" %>
					</span>&nbsp;
					<span style="color: orangered; font-size: 13px; width: 20px;">
						<%=(!vo.getHuman().equals("null"))?vo.getHuman():"" %>
					</span>&nbsp;
					<span style="color: royalblue; font-size: 13px; width: 20px;">
						<%=(!vo.getMove().equals("null"))?vo.getMove():"" %>
					</span>&nbsp;
					<span style="color: darkmagenta; font-size: 13px; width: 20px;">
						<%=(!vo.getSchedule().equals("null"))?vo.getSchedule():"" %>
					</span>&nbsp;
					<span style="color: #FFBF00; font-size: 13px; text-shadow: 0.5px -1px 0.5px black; width: 20px;">
						<%=(!vo.getUinout().equals("null"))?vo.getUinout():"" %>
					</span>
				</span>
			</td>
			<td><a href="./view.jsp?<%= param %>&no=<%= vo.getBno() %>"><%=vo.getBtitle() %></a></td>
			<td><%=vo.getUnick() %></td>
			<td><%=vo.getBwdate() %></td>
			<td><%=vo.getBhit() %></td>
			<td><%=vo.getBlike() %></td>
		</tr>
		<%
	}
	%>
</table>
<table border="0" style="width: 70%;" align="center">
		<tr style="font-size: 25px;">
			<td>
			<%
			//페이징 시작블럭번호와 끝블럭 번호를 계산한다
			int startBlock = ( (curpage - 1)  / 10) * 10 + 1;
			int endBlock   = startBlock + 10 - 1; 
			
			//endBlock 이 최대 페이지 번호보다 크면 안됨.
			if( endBlock > maxpage)
			{
				//예: maxpage가 22인데, endBlock이 30이면 endBlock을 22로 변경
				endBlock = maxpage;
			}	

			//이전 페이지 블럭을 표시한다.
			if(startBlock != 1)
			{
				%><a href="index.jsp?<%= param %>&page=<%= startBlock - 1 %>">◀</a>&nbsp;<%
			}	
			
			//화면에 블럭 페이징을 표시한다.
			for(int pno = startBlock ; pno <= endBlock; pno++)
			{
				if( curpage == pno)
				{
					//현재 페이지 이면....
					%><a href="index.jsp?<%= param %>&page=<%= pno %>"><b style="color:red;"><%= pno %></b></a>&nbsp;<%
				}else
				{
					%><a href="index.jsp?<%= param %>&page=<%= pno %>"><%= pno %></a>&nbsp;<%	
				}
			}
			
			//다음 페이지 블럭을 표시한다.
			if(endBlock < maxpage)
			{
				%><a href="index.jsp?<%= param %>&page=<%= endBlock + 1 %>">▶</a>&nbsp;<%	
			}
			%>
			</td>
		</tr>
	</table>
</body>
</html>