<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ page import="trip.util.*" %>
<%@ include file="../include/head.jsp" %>   
<link rel="stylesheet" type="text/css" href="../css/view.css">    
<%
request.setCharacterEncoding("UTF-8");
String pageno     = request.getParameter("page");
String type       = request.getParameter("type");
String bno        = request.getParameter("no");
String[] season   = request.getParameterValues("season"  );
String[] local    = request.getParameterValues("local"   );
String[] human    = request.getParameterValues("human"   );
String[] move     = request.getParameterValues("move"    );
String[] schedule = request.getParameterValues("schedule");
String[] uinout   = request.getParameterValues("uinout"  );
String[] keyword   = request.getParameterValues("keyword"  );
if(pageno  == null) pageno  = "1";
if(type    == null) type    = "T";
if(keyword == null) keyword = new String[] {""};
if(bno == null || bno.equals(""))
{
	response.sendRedirect("lobby.jsp");
	return;	
}

//íŒŒë¼ë©”í„°ë¥¼ ìƒì„±í•œë‹¤.
String search_param = "";
search_param += Param.getParam(season,"season");
search_param += "&";
search_param += Param.getParam(local,"local");
search_param += "&";
search_param += Param.getParam(human,"human");
search_param += "&";
search_param += Param.getParam(move,"move");
search_param += "&";
search_param += Param.getParam(schedule,"schedule");
search_param += "&";
search_param += Param.getParam(uinout,"uinout");

String param = "";
param += "type=" + type;
param += "&";
param += "pageno=" + pageno;
param += "&";
param += "no=" + bno;
param += "&";
param += Param.getParam(keyword,"keyword");
param += "&";
param += search_param;

//ê²Œì‹œë¬¼ ì •ë³´ë¥¼ ì¡°íšŒí•œë‹¤.
boardDTO bdto  = new boardDTO();
boardVO  bvo   = bdto.Read(bno, true);

//ê²Œì‹œë¬¼ ì²¨ë¶€íŒŒì¼ ì¡°íšŒí•œë‹¤.
attachDTO adto = new attachDTO();
attachVO  avo  = adto.Read(bno);

	
%>

<script src="//code.jquery.com/jquery.min.js"></script>
<script>
	$(document).ready(function()
	{
		/* ê¸€ëª©ë¡ë²„íŠ¼ */
		$("#index_btn").click(function(){
			document.location = "../board/index.jsp?<%= param %>";
		});
		/* ìˆ˜ì •ë²„íŠ¼ */
		$("#modify_btn").click(function(){
			document.location = "../board/modify.jsp?<%= param %>";
		});
		/* ì‚­ì œë²„íŠ¼ */
		$("#delete_btn").click(function(){
			if(confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ") == false)
			{
				return;			
			}
			document.location = "../board/delete.jsp?<%= param %>";
		});
		
		$(".btn-like").click(function() 
		{
			$(this).toggleClass("done");
		});
		
		/* ì¶”ì²œ ë²„íŠ¼ */
		$("#like").click(function() 
		{
			if(<%= login != null %>)
			{
				$("#unlike").removeClass("done");
				$.ajax({
					type : "post",
					url  : "b_likeok.jsp",
					data : 
					{
						no      : "<%= bno %>",
						pageno  : "<%=pageno%>",
						type    : "<%=type%>",
						keyword : "<%=keyword%>"
					},
					datatype : "html",
					success : function(result)
					{
						result = result.trim();
						window.location.reload();
					}
				});
				return;
			}
		});
		/* ë¹„ì¶”ì²œ ë²„íŠ¼ */
		$("#unlike").click(function() 
		{
			if(<%= login != null %>)
			{
				$("#like").removeClass("done");
				$.ajax({
					type : "post",
					url  : "b_nolikeok.jsp",
					data : 
					{
						no      : "<%= bno %>",
						pageno  : "<%=pageno%>",
						type    : "<%=type%>",
						keyword : "<%=keyword%>"
					},
					datatype : "html",
					success : function(result)
					{
						result = result.trim();
						window.location.reload();
					}
				});
				return;
			}
		});
		
		/* ëŒ“ê¸€ì‘ì„±ë²„íŠ¼ */
		$("#r_write").click(function(){
			if(confirm("ëŒ“ê¸€ì„ ì‘ì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?") == false)
			{
				return;
			}
			$.ajax({
				type : "post",
				url  : "r_writeok.jsp",
				data : 
				{
					no      : "<%= bno %>",
					rnote   : $("#rnote").val()
				},
				datatype : "html",
				success : function(result)
				{
					result = result.trim();
					alert("ëŒ“ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
					window.location.reload();
				}
			});
		});
		
	});
	
	/* ëŒ“ê¸€ìˆ˜ì •ë²„íŠ¼ */
	function reply_modify(rno)
	{
		if(confirm("ëŒ“ê¸€ì„ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?") == false )
		{
			return;
		}
		let r_modify = prompt("ëŒ“ê¸€ì„ ìˆ˜ì •í•˜ì„¸ìš”");
		$.ajax({
			type : "post",
			url  : "r_modifyok.jsp",
			data : 
			{
				no      : "<%= bno %>",
				rnote   : r_modify,
				rno     : rno
			},
			datatype : "html",
			success : function(result)
			{
				result = result.trim();
				alert("ëŒ“ê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
				window.location.reload();
			}
		});
	};
	/* ëŒ“ê¸€ì‚­ì œë²„íŠ¼ */
	function reply_delete(rno)
	{
		if(confirm("ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?") == false )
		{
			return;
		}
		$.ajax({
			type : "post",
			url  : "r_deleteok.jsp",
			data : 
			{
				rno     : rno
			},
			datatype : "html",
			success : function(result)
			{
				result = result.trim();
				alert("ëŒ“ê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
				window.location.reload();
			}
		});
	};
	
</script>

<table border="0" style="width: 100%; height: 50px; background-color: lightgray; position: relative; top: -5px;">
	<tr>
		<td class="keywords">
			<span style="color: hotpink; padding-left: 30px;"><%= bvo.getSeason() %></span> &nbsp;&nbsp;
			<span style="color: saddlebrown;"><%= bvo.getLocal() %></span>&nbsp;&nbsp;
			<span style="color: orangered;"><%= bvo.getHuman() %></span>&nbsp;&nbsp;
			<span style="color: royalblue;"><%= bvo.getMove() %></span>&nbsp;&nbsp;
			<span style="color: darkmagenta;"><%= bvo.getSchedule() %></span>&nbsp;&nbsp;
			<span style="color: ghostwhite;"><%= bvo.getUinout() %></span>
		</td>
		<td class="buttons_td"><button type="button" class="buttons" id="index_btn">ê¸€ëª©ë¡</button></td>
		<%
		if(login != null && login.getUno().equals(bvo.getUno()))
		{
			%>
			<td class="buttons_td"><button type="button" class="buttons" id="modify_btn">ìˆ˜ì •</button></td>
			<td class="buttons_td"><button type="button" class="buttons" id="delete_btn">ì‚­ì œ</button></td>
			<%
		}
		%>
	</tr>
</table>	
<table border="0" style="width: 60%; height: 350px;" align="center" id="intro_table">
	<tr>
		<td class="intro"><h1 style="color: whitesmoke; text-align:left; height:50px;">&nbsp;&nbsp;&nbsp;<%= bvo.getBtitle() %></h1></td>
	</tr>
	<tr>
		<td class="intro" height="10"><h3 style="color: whitesmoke; text-align:left;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%= bvo.getUnick() %></h3></td>
	</tr>	
	<tr>
		<td class="intro" height="10" style="text-align:left; height:50px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%= bvo.getBwdate() %> ã…£ <%= bvo.getBhit() %></td>
	</tr>
</table>
<table border="0" align="center" style="width: 60%;">
	<tr>
		<td align="center" colspan="2" style="padding: 50px;"><i  style="font-size: 50px; font-weight: bolder; text-shadow:1px 1px 10px #444;"><%= bvo.getBtitle() %></i></td>
	</tr>
		<td colspan="2">
			<%= bvo.getBnote() %>
		</td>
	<tr>
	</tr>
		<td colspan="2">
			<%
			if(avo.getFname() != null)
			{
				%>
				<img src=" ../upload/<%= avo.getFname() %> " style="width:800px;">
				<%
			}
			%>
		</td>
	<tr>
		<td style="text-align: right; padding-right: 20px; padding-top: 50px;"><button class="btn-like" id="like" style="font-size: 40px;">ğŸ‘ğŸ»</button></td>
		<td style="text-align: left; padding-left: 20px; padding-top: 50px;"><button class="btn-like" id="unlike" style="font-size: 40px;">ğŸ‘ğŸ»</button></td>
	</tr>
	<tr>
		<td style="text-align: right; padding-right: 20px;">ì¶”ì²œ: <%= bvo.getBlike() %></td>
		<td style="text-align: left; padding-left: 20px;">ë¹„ì¶”ì²œ: <%= bvo.getBhate() %></td>
	</tr>				
</table>
<hr>
<%
if(login != null)
{
	%>
	<table border="0" style="width: 70%;" align="center">
	
		<tr>
			<td align="right" style="text-align: center; font-size : 60px;">ğŸ˜„</td>
			<td>
				&nbsp;&nbsp;&nbsp;
				<input type="text" id="rnote" placeholder="ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">&nbsp;&nbsp;&nbsp;
				<button type="button" id="r_write"style="background-color: skyblue; width: 90px; height: 35px;">ëŒ“ê¸€ ì‘ì„±</button>
			</td>
		</tr>
	</table>	
	<%
}

replyDTO rdto = new replyDTO();
ArrayList<replyVO> rlist = rdto.GetList(bno);
for(replyVO rvo : rlist)
{
	%>
	<table border="0" style="width: 60%;" align="center">
		<tr>
			<td colspan="4"><hr style="width: 100%; border:0px; height:1px; background: linear-gradient(to left, transparent, #87CEEA, transparent);"></td>
		</tr>	
		<tr>
			<td rowspan="2" style="text-align: center; font-size : 40px;">
				<%=rvo.getUicon() %>
			</td>
			<td style="font-size: 20px;" width="100"><%=rvo.getUnick() %></td>
			<td style="font-size: 15px;"><%=rvo.getRwdate() %></td>
			<td style="text-align: right; height: 20px; padding-right: 100px;">
				<%
				if(login != null && login.getUno().equals(rvo.getUno()))
				{
					%>
					<a href="javascript:reply_modify('<%= rvo.getRno() %>');"><span class="reply_btn" id="reply_modify" style="width: 60px; height: 25px; background-color: navajowhite; border-radius: 0.2em; border: 0;">ìˆ˜ì •</span></a>
					<a href="javascript:reply_delete('<%= rvo.getRno() %>');"><span class="reply_btn" id="reply_delete" style="width: 60px; height: 25px; background-color: navajowhite; border-radius: 0.2em; border: 0;">ì‚­ì œ</span></a>
					<%
				}
				%>
			</td>
		</tr>
		<tr>
			<td colspan="3" style="padding-bottom: 30px;"><%=rvo.getRnote() %></td>					
		</tr>
	</table>
	<%
}
%>
</body>
</html>